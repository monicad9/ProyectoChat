<!DOCTYPE html>
<html>
	<head>
		<title>WhatsChat</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"></head>

        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
        <script src="./delivery.js"></script>
        <link rel="stylesheet" type="text/css" href="./whatsapp.css">



		<script>
        var socket = io.connect();

        $(document).ready(function(){

            $('#enviarNombre').click(function(){
                
                socket.emit('newUser', $('#enviarNombre').val(), function(data){
                    if(data){
                        $('#nombres_contactos').hide();
                        $('#whatsapp').show();
                    }
                    else{
                        $('#login-error').show();
                    }
                
                });
            });

            $('form').submit(function(){
                if ($('#m').val().trim()!=''){
                    socket.emit('sendMessage' , $('#m').val());
                    $('#m').val('');
                    return false;
                }
            });

            socket.on('newMessage' , function(data){
                $('#messages').append('<p>' + data.msg);
            })

            socket.on('Usuarios', function(data){
                var users = "";
                for (var a in data){
                    users += a;
                }

               $('.usuarios_conectados').html("<p><img id='fotoPersonal' src='./persona.png'>" +  users + "</p>");
            })



            //COPIA DE SEGURIDAD
/*            $('form').submit(function(){
                if ($('#m').val().trim()!='') socket.emit('chat message', $('#m').val());
                $('#m').val('');
                return false;
                });
              
                socket.on('chat message', function(msg){
                    $('#messages').append($('<li id="emisor">').text(msg));
                
            });

          
          socket.on('connect', function(){
                var delivery = new Delivery(socket);
             
                delivery.on('delivery.connect',function(delivery){
                    $("input[type=submit]").click(function(evt){

                        var file = $("input[type=file]")[0].files[0];
                        var extraParams = {foo: 'bar'};
                        delivery.send(file, extraParams);
                        evt.preventDefault();
                    });
                });
             
                delivery.on('send.success',function(fileUID){
                    console.log("file was successfully sent.");
                });
                
                delivery.on('receive.start',function(fileUID){
                    console.log('receiving a file!');
                });
                 
                delivery.on('receive.success',function(file){
                    var params = file.params;
                    if (file.isImage()) {
                        $('img').attr('src', file.dataURL());
                    };
                });*/



/*                delivery.on('receive.success',function(file){
            
                    fs.writeFile(file.name, file.buffer, function(err){
                      if(err){
                        console.log('File could not be saved: ' + err);
                    }

                    else{
                        console.log('File ' + file.name + " saved");
                    };
                });
            });

        */


        });



        </script>
	</head>

	<body>

		<div class="container">

			<div class="row">
				<div class="col-md-12 col-lg-12 col-xs-12" id="cabecera"></div>
			</div>
            
            <div class="input-group" id="nombres_contactos">
                <input type="text" id="nombre_contacto" class="form-control input-lg" placeholder="Enter your name" />
                <span class="input-group-btn">
                    <button class="btn btn-lg btn-success" type="sumbit" id="enviarNombre">Send</button>
                </span>
            </div>

          <div class="alert alert-danger alert-dismissable fade in" id="login-error"style="display:none;">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            Lo siento, ese usuario ha sido registrado previamente. Pruebe con otro nombre.
          </div>

			<div class="row" id="whatsapp"> 
				

				<div class="col-md-3 col-lg-3 col-sm-3 col-xs-3" id="contactos">


					<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12" id="datos">
						<div class="cabeceraPersonal">
                            
                            <img id="fotoPersonal" src="./persona.png"> Mónica
                                    
                        </div>

					</div>

					<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12" id="search">
						<div class="left-inner-addon">
							<!-- <i class="glyphicon glyphicon-search"></i> -->
							<input type="text" class="form-control" placeholder= "Search a contact">
						</div>

					</div>

					<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 usuarios_conectados">
						<p class="active"><img id="fotoPersonal" src="./persona.png"> Chat grupo</p>
						<p> <img id="fotoPersonal" src="./persona.png"> Persona 2</p>

					</div>

				</div>


				<div class="col-md-9 col-lg-9 col-sm-9 col-xs-9">

					<div class="row">

						<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12" id="contenedor2">
                            <div class="row">
                                <div class="cabeceraContacto">
                                    <img id="fotoPersonal" src="./persona.png">Chat grupo
                                    
                               </div>
                                <span id="messages"></span>
                            <form>
                                <input id="m" placeholder="Escribe un mensaje aquí" /><button id="button">Send</button>

<!--                                 <input type="file"><button type="sumbit" class="envio">Send file</button> -->
                            </form>
						</div>
					</div>
				</div>

			</div>

		</div>

	</body>
</html>