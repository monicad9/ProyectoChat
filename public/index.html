<!DOCTYPE html>
<html>
	<head>
		<title>WhatsChat</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"></head>

        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
        <script src="./delivery.js"></script>
        <link rel="stylesheet" type="text/css" href="./whatsapp.css">



		<script>
            var socket = io.connect();

            $(function(){

/*                $('#enviarNombre').keypress(function(e) {
                    if (e.which == 13) {
                        return false;
                    }
                });*/



                function animateScroll(){
                    var container = $('#contenedor2');
                    container.animate({"scrollTop": container[0].scrollHeight}, "slow");
                }

                $('#enviarNombre').click(function(){
                    
                    socket.emit('newUser', $('#nombre_contacto').val(), function(data){
                        if(data){
                            $('body').css('background-color','white')
                            $('#nombres_contactos').hide();
                            $('.modal-backdrop').hide();
                            $('#login-error').hide();
                            $('.login').hide();
                            $('#whatsapp').show();
                            $('.cabeceraPersonal').append("<img id='fotoPersonal' src='./persona.png'>" + $('#nombre_contacto').val())
                        }
                        else{
                            $('#login-error').show();

                        }
                    
                    });
                });

                $('form').submit(function(e){
                    e.preventDefault();
                    if ($('#m').val().trim()!=''){
                        socket.emit('sendMessage' , $('#m').val());
                        $('#m').val('');
                        return false;
                    }
                });

                socket.on('newMessage' , function(data){
                    
                    $('#messages').append('<div class="arrow_box"><div class="nick">' + data.nombre + "</div>" +  data.msg + "</div>");
                    animateScroll();
                })

                socket.on('Usuarios', function(data){
                    var users = "";
                    for (var a in data){
                        users += a;

                    }

                    $('.usuarios_conectados').html("");
                    $('.usuarios_conectados').append("<div class='cont'><img id='fotoPersonal' src='./persona.png'>" +  users + "</div>");
                })

            });

        </script>
	</head>

	<body>

		<div class="container">

            <!-- Pantalla principal -->

			
				<div class="col-md-12 col-lg-12 col-xs-12" id="cabecera"></div>
			
            <!-- ************* -->


            <button class="btn btn-primary btn-lg login" data-toggle="modal" data-target="#nombres_contactos">Entrar</button>

            <!-- Modal -->
            <div class="modal fade"  data-backdrop="static" data-keyboard="false"  id="nombres_contactos" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">

                            <button type="button" class="close" data-dismiss="modal">
                                   <span aria-hidden="true">&times;</span>
                                   <span class="sr-only">Close</span>
                            </button>

                            <h4 class="modal-title" id="myModalLabel">Ingresar en Whatschat</h4>
                        </div>
                        
                        <!-- Modal Body -->
                        <div class="modal-body">
                            
                            <form class="form-horizontal" role="form">
                              <div class="form-group">
                                <label  class="col-sm-2 control-label" for="nombre_contacto">Nombre</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="nombre_contacto" autocomplete="off" placeholder="Introduce tu nombre"/>
                                </div>
                              </div>
                       
                            </form>
                           
                        </div>
                        
                        <!-- Modal Footer -->
                        <div class="modal-footer">
                                      <div class="alert alert-danger alert-dismissable fade in" id="login-error"style="display:none;">
                                        
                                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                            Lo siento, ese usuario ha sido registrado previamente. Pruebe con otro nombre.
                                        </div>
                            <button type="button" class="btn btn-lg btn-success" id="enviarNombre">Send</button>
                        </div>
                    </div>
                </div>
            </div>

        <!-- ************************************** -->

        <!-- Pantalla de whatsapp -->

			<div class="row" id="whatsapp"> 
				
                <!-- Lateral izquierdo -->
				<div class="col-md-3 col-lg-3 col-sm-3 col-xs-3" id="contactos">

                    <!-- Cabecera de usuario -->
					<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12" id="datos">
						<div class="cabeceraPersonal">
                            
                           <!--  <img id="fotoPersonal" src="./persona.png"> Mónica -->
                                    
                        </div>
                   
					</div>

                    <!-- Usuarios conectados, foto incluida -->
					<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 usuarios_conectados">
						<p class="active"><img id="fotoPersonal" src="./persona.png"> Chat grupo</p>
						<p> <img id="fotoPersonal" src="./persona.png"> Persona 2</p>

					</div>

				</div>

                <!-- Lateral derecho. Conversación -->

				<div class="col-md-9 col-lg-9 col-sm-9 col-xs-9">

					<div class="row">

						<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12" id="contenedor2">
                            <div class="row">

                                <!-- Usuario con el que se mantiene la conversación -->
                                <div class="cabeceraContacto">
                                    <img id="fotoPersonal" src="./persona.png">Chat grupo
                                    
                               </div>
                                <span id="messages"></span>
<!--                                 <form id="inputWhatsapp">
                                    <input id="m" placeholder="Escribe un mensaje aquí" /><button id="button">Send</button>

                                </form> -->
						    </div>



					   </div>

                            <form id="inputWhatsapp">
                                <input id="m" autocomplete="off" placeholder="Escribe un mensaje aquí" /><button id="button">Send</button>

                            </form>
				    </div>

			    </div>

		     </div>
        </div>



	</body>
</html>